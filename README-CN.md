# sd-tagtool

这是一个简单的 stable diffusion 数据集标签编辑器。可用于编辑自动标签工具生成的数据集。这个工具受到了 [BooruDatasetTagManager](https://github.com/starik222/BooruDatasetTagManager) 的启发。

## 特性

- 支持所有图像标签的显示和管理
- 支持撤销/重做
- 标签输入智能提示（支持模糊匹配）
- 支持拖拽标签
- 可批量插入/删除标签，可指定插入位置
- 可通过标签过滤数据集
- 可自定义的标签高亮
- 自动翻译（现在写死了翻译到中文，并且可能需要魔法上网）
- 反应很快

## 截图
![screenshot.png](images/screenshot.webp)

## 下载 / 安装

sd-tagtool 支持 Windows，macOS 和 Linux。安装步骤如下：
1. 在 [Release](https://github.com/skiars/sd-tagtool/releases) 页面找到最新的版本；
2. 依据操作系统从 **Assets** 列表中下载安装包文件，例如 Windows 安装包的后缀是 **_.msi_** 或者 **_.exe_**；
3. 运行安装文件。

**备注**：sd-tagtool 可能需要较新的 Windows 10 或者 Windows 11 才能运行。此外，我较少测试 Linux 和 MacOS 的兼容情况。

## 使用方法

基本的用法大家可以自己尝试，这里只补充几个细节。

### 基本的标签编辑

当你选中一个图片之后，拖拽图片的标签即可排序。点击标签上的 `×` 图标即可删除。不过当你选择了多张图片之后就不能再对标签进行排序了。

你还可以打开 *edit all tags* 开关，这样可以删除整个数据集中的标签（全部标签显示在窗口下方）。例如删除全部标签中的 "1girl" 会导致所有图片中的 "1girl" 标签被删除。

### 插入标签

在 *add tag* 输入框中输入标签然后点 *Insert* 按钮即可将新的标签插入到选中的数据集中（你可以选择多张图片）。如你所见 *add tag* 输入框中可以填写多个 tag。

插入的位置由 *position* 输入框决定。目前支持 3 种模式：
- **auto**：如果图片中不存在要插入的标签就将该标签插到末尾，否则什么也不做；
- **正数**：把标签插入到从头部往后数的第几个位置，如果图片已经存在该标签则会将其移动到指定位置；
- **负数**：和正数类似，不过是从尾部往前数。

插入位置可以超出图片实际的标签数量，此时会将标签插到头部或尾部位置。

直接在全部标签列表中双击某个标签也会将其插入到选中图片的标签集种。此时的插入位置也是由 *position* 参数决定的。

### 撤销 / 重做

点击 *Edit* 菜单种的 *Undo* 和 *Redo* 可以进行撤销和重做，还可以使用对应的快捷键来操作。

撤销和重做都没有步数限制，但是目前没有比较合理的交互反馈（这会导致你可能不知道发生了什么操作）。另外，打开新的目录之后会清除撤销历史记录。

### 标签过滤

在顶部的标签过滤栏中填写需要过滤的标签，然后点击 *Filter* 按钮即可过滤数据集。通过 *exclude* 复选框可以选择两种过滤模式：
- **包含模式**：图片具有过滤器中的所有标签时会在过滤后的列表中展示；
- **排除模式**：图片不具有过滤器中的所有标签时会在过滤后的列表中展示。

当你编辑了数据集之后，需要重新点击 *Filter* 按钮来更新过滤后的数据集。你可以手动输入标签，也可以在标签列表中点击鼠标右键并通过 *Add filter* 菜单将指定标签添加到过滤器中。

### 标签高亮

你可以在标签的的上下文菜单（点击鼠标右键）的 *Pick color* 为标签选择一个醒目的颜色，这样就可以快速找到它。当你不需要标签高亮时可以通过上下文菜单的 *Clear picked color* 来清除。

### 翻译

点 *View* 的 *Translate tags* 菜单可以打开或关闭自动翻译。

## 警告

关闭 sd-tagtool 之前记得保存文件，否则会丢失所有数据。。。我现在没有做确认对话框。另外打开新的目录或者刷新之前也要记得保存文件（右键菜单有刷新选项，Ctrl + R 也可以刷新，不要手贱）。

## 开发

本项目基于 tauri 和 vue。构建方法如下：
``` bash
pnpm install
pnpm tauri dev
pnpm tauri build
```

具体的配置可以看 [GitHubAction configuration](.github/workflows).
